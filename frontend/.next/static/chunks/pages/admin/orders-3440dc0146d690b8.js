(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[659],{300:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>m});var n=t(7876),r=t(7328),a=t.n(r),i=t(4232),d=t(9872),l=t.n(d),c=t(8230),o=t.n(c),h=t(9099),_=t(5364);let m=()=>{let[e,s]=(0,i.useState)([]),[t,r]=(0,i.useState)(!0),[d,c]=(0,i.useState)(null),[m,u]=(0,i.useState)(null),x=(0,h.useRouter)(),j=_.env.NEXT_PUBLIC_API_BASE_URL,p=["pending","confirmed","processing","completed","cancelled"],g={pending:"待處理",confirmed:"已確認",processing:"處理中",completed:"已完成",cancelled:"已取消"},A=async()=>{if(!j){c("API 服務目前無法使用。"),r(!1);return}r(!0),c(null);try{let e=await fetch("".concat(j,"/api/orders"),{credentials:"include"});if(401===e.status||403===e.status)return void x.push("/admin/login");if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.message||"HTTP error! status: ".concat(e.status))}let t=await e.json();s(t)}catch(e){console.error("Failed to fetch orders:",e),e instanceof Error&&e.message.includes("401")||e instanceof Error&&e.message.includes("403")||c(e.message||"無法載入訂單資料，請稍後再試。")}r(!1)};(0,i.useEffect)(()=>{A()},[j,x]);let C=async(e,t)=>{if(!j){c("更新訂單 ".concat(e," 狀態失敗: API 服務無法使用。")),u(null);return}u(e),c(null);try{let n=await fetch("".concat(j,"/api/orders/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t}),credentials:"include"});if(!n.ok){let e=await n.json();throw Error(e.message||"更新狀態失敗")}s(s=>s.map(s=>s._id===e?{...s,status:t}:s))}catch(s){console.error("Failed to update order status:",s),c("更新訂單 ".concat(e," 狀態失敗: ").concat(s.message))}u(null)},N=e=>e?new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):"N/A",S=e=>e?new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return t?(0,n.jsx)("div",{className:l().container,children:(0,n.jsx)("p",{className:l().loadingText,children:"正在載入訂單..."})}):d&&!m?(0,n.jsx)("div",{className:l().container,children:(0,n.jsxs)("p",{className:l().errorText,children:["錯誤: ",d]})}):(0,n.jsxs)("div",{className:l().container,children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:"訂單管理 - 廣翊輪胎行"}),(0,n.jsx)("meta",{name:"robots",content:"noindex, nofollow"})," "]}),(0,n.jsx)("h1",{className:l().pageTitle,children:"訂單管理"}),d&&m&&(0,n.jsxs)("p",{className:l().errorTextInline,children:["更新訂單 ",m," 狀態時發生錯誤: ",d]}),0===e.length?(0,n.jsx)("p",{children:"目前沒有任何訂單。"}):(0,n.jsx)("div",{className:l().tableScrollContainer,children:(0,n.jsxs)("table",{className:l().ordersTable,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"訂單提交日期"}),(0,n.jsx)("th",{children:"姓名"}),(0,n.jsx)("th",{children:"電話"}),(0,n.jsx)("th",{children:"Email"}),(0,n.jsx)("th",{children:"訂購品項"}),(0,n.jsx)("th",{children:"規格"}),(0,n.jsx)("th",{children:"數量"}),(0,n.jsx)("th",{children:"車輛"}),(0,n.jsx)("th",{children:"需安裝"}),(0,n.jsx)("th",{children:"預約安裝日期"}),(0,n.jsx)("th",{children:"預約時段"}),(0,n.jsx)("th",{children:"狀態"}),(0,n.jsx)("th",{children:"備註"})]})}),(0,n.jsx)("tbody",{children:e.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:S(e.createdAt)}),(0,n.jsx)("td",{children:e.name}),(0,n.jsx)("td",{children:e.phone}),(0,n.jsx)("td",{children:e.email||"-"}),(0,n.jsx)("td",{children:e.tireBrandSeries||"-"}),(0,n.jsx)("td",{children:e.tireSpecs||"-"}),(0,n.jsx)("td",{children:e.quantity}),(0,n.jsx)("td",{children:"".concat(e.carMake||""," ").concat(e.carModel||""," (").concat(e.carYear||"N/A",")")}),(0,n.jsx)("td",{children:"yes"===e.needsInstallation?"是":"否"}),(0,n.jsx)("td",{children:"yes"===e.needsInstallation&&e.appointmentDate?N(e.appointmentDate):"-"}),(0,n.jsx)("td",{children:"yes"===e.needsInstallation&&e.appointmentTime?e.appointmentTime:"-"}),(0,n.jsxs)("td",{className:"".concat(l().statusCell," ").concat(l()["status".concat(e.status.charAt(0).toUpperCase()+e.status.slice(1))]),children:[(0,n.jsx)("select",{value:e.status,onChange:s=>C(e._id,s.target.value),className:l().statusSelect,disabled:m===e._id,children:p.map(e=>(0,n.jsxs)("option",{value:e,children:[g[e]||e," "]},e))}),m===e._id&&(0,n.jsx)("span",{className:l().loadingSpinner})," "]}),(0,n.jsx)("td",{className:l().notesCell,children:e.notes||"-"})]},e._id))})]})}),(0,n.jsx)("div",{className:l().backLinkContainer,children:(0,n.jsx)(o(),{href:"/",className:l().backLink,children:"返回首頁"})})]})}},7556:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/orders",function(){return t(300)}])},9099:(e,s,t)=>{e.exports=t(8253)},9872:e=>{e.exports={container:"AdminOrders_container__yaItS",pageTitle:"AdminOrders_pageTitle__P0u_I",loadingText:"AdminOrders_loadingText__SJFwZ",errorText:"AdminOrders_errorText__vc464",tableScrollContainer:"AdminOrders_tableScrollContainer__i9YJM",ordersTable:"AdminOrders_ordersTable__YGiL5",statusCell:"AdminOrders_statusCell__4spqc",statusPending:"AdminOrders_statusPending__2siiN",statusConfirmed:"AdminOrders_statusConfirmed__GnS0Z",statusProcessing:"AdminOrders_statusProcessing__pwdJA",statusCompleted:"AdminOrders_statusCompleted__qEC6W",statusCancelled:"AdminOrders_statusCancelled__GvhLX",statusSelect:"AdminOrders_statusSelect__ht2LS",loadingSpinner:"AdminOrders_loadingSpinner__r_kSE",spin:"AdminOrders_spin__AzLlG",notesCell:"AdminOrders_notesCell__B1oOF",backLinkContainer:"AdminOrders_backLinkContainer__Acr7q",backLink:"AdminOrders_backLink____WX9"}}},e=>{var s=s=>e(e.s=s);e.O(0,[636,593,792],()=>s(7556)),_N_E=e.O()}]);